<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Edit</title>
        <link rel="stylesheet"  type="text/css" href="add.css"/>
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Righteous&display=swap" rel="stylesheet">
    </head>
    <script>
   "use strict";
    const handleResponse = (e) => {
        const xhr = e.target;
        const content = document.querySelector('#updateBudget');
        
        switch(xhr.status){
        case 200:
            content.innerHTML = '<b>Success!</b>';
            break;
        case 201:
            content.innerHTML = '<b>Created!</b>';
            break;
        case 204:
            content.innerHTML = '<b>Updated (No Content)!</b>';
            break;
        case 400:
            content.innerHTML = '<b>Bad Request!</b>';
            break;
        default:
            content.innerHTML = '<b>Error code not implemented by client</b>';
        }
        
        // make sure that something is in the .response property first!
        const obj = xhr.response && JSON.parse(xhr.response);
        console.dir(obj);
    };

      const sendPost = (e, budgetForm) => {
			e.preventDefault();
			
			const budgetAction = budgetForm.getAttribute("action");
			const budgetMethod = budgetForm.getAttribute("method");
			
            const budgetField = budgetForm.querySelector("#changeBudgetText").value;
            
            const xhr = new XMLHttpRequest();
            xhr.open(budgetMethod,budgetAction); 
            
            xhr.setRequestHeader('Accept','application/javascript');
            xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
            
            xhr.onload = () =>  handleResponse;
            
            const formData = `budget=${budgetField}`;
            xhr.send(formData); 	
    
			return false; // prevents event bubbling
    };

    const sendExpensePost = (e, budgetForm) => {
        e.preventDefault();
			
    	const budgetAction = budgetForm.getAttribute("action");
        const budgetMethod = budgetForm.getAttribute("method");

        const itemField = budgetForm.querySelector('#itemText').value;
        const costField = budgetForm.querySelector('#costText').value;
        const typeField = budgetForm.querySelector('#typeText').value;
        const necessaryField = budgetForm.querySelector('#necessaryText').value;

        const xhr = new XMLHttpRequest();
        xhr.open(budgetMethod,budgetAction);

        xhr.setRequestHeader('Accept','application/javascript');
        xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
        
        xhr.onload = () =>  handleResponse;
        
        const formData = `item=${itemField}&cost=${costField}&type=${typeField}&necessary=${necessaryField}`;
        xhr.send(formData); 

        return false;
    };
      
      const init = () => {
        const budgetForm = document.querySelector('#changeBudgetForm');
        const expenseForm = document.querySelector('#addExpense');

        const changeBudget = (e) => sendPost(e, budgetForm);
        const addExpense = (e) => sendExpensePost(e, expenseForm);

        budgetForm.addEventListener('submit', changeBudget);
        expenseForm.addEventListener('submit', addExpense);
      };
      
      window.onload = init;
     
    </script>
    <body>
        <ul id ="topnav">
            <li><a href="/index.html">Home</a></li>
            <li><a href="/app.html">App</a></li>
            <li><a href="/add.html">Edit</a></li>
            <li><a href="/admin.html">Admin</a></li>
        </ul>

        <div id="container">
        <h1>Edit</h1>
     
        <section>
            <h2>Change Budget</h2>
            <form id="changeBudgetForm" action="/addBudget" method="post">
              <label for="Budget">Budget: </label>
              <input id="changeBudgetText" type="number" name="Budget" min="0" max="1000000" step="0.01"/>
              <input class="submit" type="submit" value="Change Budget"/>
            </form>
            <div id="updateBudget">

            </div>
        </section>

        <section>
            <h2>Add Expense</h2>
            <form id="addExpense" action="/addExpense" method="post">
              <label for="item">Item: </label>
              <input id="itemText" type="text" name="item" onfocus="this.value=''" value="Ex. Banana">
              <label for="cost">Cost: </label>
              <input id="costText" type="number" name="cost" min="0" max="100000000000" step="0.01" value=0.99>
              <label for="type">Type: </label>
              <input id="typeText" type="text" name="type" onfocus="this.value=''" value="Ex. Food/Drink">
              <label for="necessary">Necessary: </label>
              <input id="necessaryText" type="text" name="necessary" onfocus="this.value=''" value="Ex. Yes/No">
              <input class="submit" type="submit" value="Add Expense"/>
            </form>
          </section>
        </div>
    </body>
</html>